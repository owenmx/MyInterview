#### 1. 基本简介

>   问题

海量数据题，面临的问题主要分为两点，一点是数据量太大，无法在较短时间内迅速解决；一点是数据量太大，无法一次性装入内存。

>   解决方法

针对时间：结合巧妙的算法 + 合适的数据结构，比如 `Bloom filter/Hash/bit-map/堆/数据库或倒排索引/trie树`；

针对空间：大而化小，分而治之；将大规模数据化为小规模数据，各个击破，基于贪心或者分治的思想。

>   单机及集群问题

单机就是处理装载数据的机器有限`只要考虑cpu，内存，硬盘的数据交互`；

集群，机器有多台，适合分布式处理，并行计算 `更多考虑节点和节点间的数据交互`。



#### 2. 基础知识

##### 2.1 计算机存储的基本单位

+   一个`int` 的大小一般为`4个字节`，`32位`。
+   一个`char`的大小一般为`2个字节`，`16位`。
+   计算机存储是按照二进制元的，`1MB=1024KB=1024x1024B`。

#### 2.2 海量数据问题之六把密匙

1.  `分而治之/一致性哈希` + `频数统计` + `堆/快速/归并排序`
2.  `双层桶划分`
3.  `Bloom filter`
4.  `Trie树/数据库/倒排索引`
5.  `外排序`
6.  `分布式处理之Map-Reduce`

##### 2.3 外排序

`外部排序`指的是大文件的排序，即待排序的记录存储在外存储器上，待排序的文件无法一次装入内存，需要在内存和外部存储器之间进行多次数据交换，以达到排序整个文件的目的。

`内部排序`就是可以在内存中完成的排序

+   **多路归并思想**

外部排序最常用的算法是多路归并排序，即将原文件分解成多个能够一次性装人内存的部分，分别把每一部分调入内存完成排序。然后，对已经排序的子文件进行归并排序。　　

![图片](../../LeetCode刷题/images/16859942908a6035~tplv-t2oaga2asx-watermark.awebp)

#### 3. 面试题

##### 3.1 海量日志数据，提取出某日访问百度次数最多的那个IP

**解决思路：** 

+   数据划分，日志数据太大：

    假设一条日志按照字符存储，每个字符占两个字节，长度最长为50，那么对于`1亿条日志`：
    $$
    50\times 2B \times 10^8 = (10^{10} / 1024) B \sim 10GB
    $$
    

    对数据进行hash（一致性哈希映射）操作，然后取模`%1000`划分到1000台机器上，这样相同的数据会被划分到同一个机器上。

+   各自统计频率，每台机器利用字典 `dict` 统计频率。

+   得到每台机器频率最大的 `IP`，最后得到全局次数最多的`IP`。



#### 3.2 寻找热门查询，300万个查询字符串中统计最热门的10个查询

首先利用哈希表进行 `频率统计` ，然后构建 `小根堆` 来统计最热门的查询。



#### 3.3 有一个`1G`大小的一个文件，里面每一行是一个词，词的大小不超过16字节，内存限制大小是1M。返回频数最高的100个词。

+   分治，基于hash函数，将该所有单词划分到很多个小文件中。
+   统计，每个小文件，利用哈希表统计。
+   排序，利用小根堆或者归并排序，得到频数最高的100个词。



#### 3.4 10亿个无序整数 找中位数

**解决思路：**

使用`双层桶划分(分而治之)`的策略。假设题目中指的是32位的无符号整数，共有 $2^{32}$ 个数字。

+   我们将 $2^{32}$ 这个范围划分成 $2^{10}$ 个区域。对数据进行第一次扫描，统计各个落到各个区域内的数字的个数。
+   第一次扫描后，通过统计就可以知道，中位数在哪个区域内，以及它是这个区域的第几大的数字。
+   进行第二次扫描，这次只统计落到目标区域内的数字，同时结合Bitmap记录都出现了哪些数字。最后通过Bitmap和第一次扫描的结论，就可以找到那个中位数了。

#### 3.5 给你A,B两个文件，各存放50亿条URL，每条URL占用64字节，内存限制是4G，让你找出A,B文件共同的URL。如果是三个乃至n个文件呢？

+   如果允许一定的错误率，可以采用 `Bloom filter`。
+   否则还是采用分而治之的方案。



#### 3.6 给40亿个不重复的unsigned int的整数，没排过序的，然后再给一个数，如何快速判断这个数是否在那40亿个数当中？

**解题思路：**

用 `位图/Bitmap` 的方法，申请512M的内存，一个bit位代表一个 `unsigned int` 值。读入40亿个数，设置相应的bit位，读入要查询的数，查看相应bit位是否为1，为1表示存在，为0表示不存在。





#### 3.7 腾讯面试题：出重复数，假设由2.5亿个数，其中只有一个数出现两次，其他都出现一次，怎么找出这个重复数？[Ref](https://leetcode-cn.com/circle/discuss/6TtGra/)

讨论数的范围，如果是int数字的话，大小是4个字节，那么2.5亿个数就是:
$$
2.5\times 10^8 \times 4 = 10^9\text{B}=1000\text{MB}=1\text{GB}
$$
将他划分成1000份，依次处理；







