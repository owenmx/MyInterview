#### TCP 和UDP  Transmission Control Protocol & User Datagram Protocol

UDP面向无连接，不可靠，尽最大可能交付，没有拥塞控制，支持一对一，一对多，多对一，多对多。

TCP面向链接，可靠，由流量控制，拥塞控制，全双工通信，点对点通信。





#### TCP 为什么要进行三次握手建立链接 ~ 本质上是相互接发能力的确认

第一次握手，客户端发送了信息，服务器接收了信息。服务器确认了客户端的发送能力和服务器的接受能力。

第二次握手，服务器发送了信息，客户端接收了信息。客户端确认了大家的发送能力和接收能力。

第三次握手，客户端发送了信息，服务器接收了信息。服务器确认了大家的发送能力和接收能力。





#### TCP 为什么要进行四次握手断开链接 

因为TCP协议是全双工的，意味着客户端既可以发送数据，也可以接受数据、

前两次握手，客户端不再发送数据；但是仍然可以接收数据。

后两次握手，客户端确认不再接收数据。



#### TCP 如何保证可靠性

我们都知道 TCP 是具有可靠性的通信协议，它主要通过以下方式确保可靠性，这里先了解一下可靠性的原理，其中细节部分后文会讲：

-   合理的数据大小：TCP 发送的数据并不是固定的大小，而是会根据实际情况调整报文段的大小。
-   检验和：发送端按照特定算法计算出 TCP 报文段的检验和并存储在 TCP 首部中的对应字段上，接收端在接收时会以同样的方式计算校验和，如果不一致，说明报文段出现错误，会将其丢弃。
-   序号与确认序号：对乱序的数据进行排序后发给应用层，并丢弃重复的数据。
-   超时重传机制：当 TCP 发出一个报文段后，它会启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段，后面会细讲这个机制。
-   连接管理：也就是三次握手和四次挥手，连接的可靠性是整体可靠性的前提，本文第二部分将会详细介绍连接管理的内容。
-   流量控制：TCP 双方都有固定大小的缓冲区，流量控制的原理是利用滑动窗口控制数据发送速度，避免缓冲区溢出导致数据丢失。
-   拥塞控制：TCP 利用慢启动和拥塞避免等算法实现了拥塞控制。

上面为大家介绍了 TCP 最重要的三个特点，在本文第一部分的最后，再来看看 TCP 和 UDP 的对比吧。



#### TCP 建立流程 https://www.youtube.com/watch?v=wQ4_N73duO0



#### SYN 确认字

延伸问题：为什么要传回 SYN？
接收端传回发送端所发送的 SYN 是为了告诉发送端，我接收到的信息确实就是你所发送的信号了。

SYN 是 TCP/IP 建立连接时使用的握手信号。在客户机和服务器之间建立正常的 TCP 网络连接时，客户机首先发出一个 SYN 消息，服务器使用 SYN-ACK 应答表示接收到了这个消息，最后客户机再以 ACK(Acknowledgement[汉译：确认字符 ,在数据通信传输中，接收站发给发送站的一种传输控制字符。它表示确认发来的数据已经接受无误。 ]）消息响应。这样在客户机和服务器之间才能建立起可靠的TCP连接，数据才可以在客户机和服务器之间传递。

延伸问题：传了 SYN,为啥还要传 ACK
双方通信无误必须是两者互相发送信息都无误。传了 SYN，证明发送方到接收方的通道没有问题，但是接收方到发送方的通道还需要 ACK 信号来进行验证。 作者：Android开发骆驼 https://www.bilibili.com/read/cv7631133/ 出处：bilibili



#### TCP和UDP的报文格式

UDP![UDP 包头](../../LeetCode刷题/images/6d1313f51b9dfd7ab454b2cef1cb37bf.jpg)

TCP![TCP 包头](../../LeetCode刷题/images/a795461effcce686a43f48e094c9adbf.jpg)

-   顺序问题
-   丢包问题
-   连接维护
-   流量控制
-   拥塞控制
